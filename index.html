<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>River Forest Teacher Salary Competitiveness Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-bottom: 30px;
        }
        .chart-wrapper {
            width: 100%;
            height: 500px;
            margin-bottom: 30px;
            position: relative;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f1f3f4;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .stat-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .correlation {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
        }
        .note {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .performance-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e9ecef;
        }
        .performance-section h2 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .subject-selector {
            text-align: center;
            margin: 20px 0;
        }
        .subject-selector label {
            margin: 0 20px;
            font-weight: bold;
            cursor: pointer;
        }
        .subject-selector input[type="radio"] {
            margin-right: 8px;
        }
        .analysis-summary {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
        }
        .analysis-summary h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 24px;
        }
        .finding-box {
            background: white;
            border-left: 4px solid #3498db;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .finding-box.highlight {
            border-left-color: #e74c3c;
            background: #fff5f5;
        }
        .finding-box h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        .finding-box p {
            margin: 0;
            line-height: 1.6;
            color: #34495e;
        }
        .methodology {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-style: italic;
            color: #2c5530;
            border: 1px solid #a8d8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>River Forest Teacher Salary Competitiveness Analysis</h1>
        <div class="subtitle">Comprehensive analysis of 31 Illinois school districts comparing teacher compensation, community wealth, and academic performance</div>

        <!-- Executive Summary -->
        <div class="analysis-summary">
            <h2>Key Findings</h2>
            <p><strong>River Forest SD 90 ranks #1-2 in performance per dollar</strong>, achieving exceptional results (76.4% ELA, 66.8% Math proficiency) with below-market teacher compensation. While performance correlates with both income and teacher pay, <strong>significant variation shows higher resources don't guarantee better outcomes</strong> - uncaptured factors, likely including teacher quality and school operations, make a big difference.</p>

            <div class="methodology">
                <em>Analysis uses 2024 IAR data, 2019-2023 ACS income averages, and ISBE teacher salary data.</em>
            </div>
        </div>

        <h2>Detailed Analysis: Household Income vs Teacher Salary</h2>
        <div class="subtitle">2019-2023 ACS 5-year average income data & Illinois teacher salaries</div>

        <div class="chart-wrapper">
            <canvas id="chart"></canvas>
        </div>

        <div class="correlation" id="correlation">
            Correlation will be calculated...
        </div>

        <div class="stats">
            <div class="stat-box">
                <h3>Avg Household Income (2019-2023)</h3>
                <div id="incomeStats">Loading...</div>
            </div>
            <div class="stat-box">
                <h3>Avg Teacher Salary</h3>
                <div id="salaryStats">Loading...</div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>District</th>
                    <th>Avg Household Income</th>
                    <th>Avg Teacher Salary</th>
                    <th>Salary Source</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>

        <div class="note">
            <strong>Data Sources:</strong>
            <ul>
                <li>Household Income: US Census Bureau 2019-2023 ACS 5-year estimates (average household income)</li>
                <li>Teacher Salaries: Illinois Report Card, Illinois State Board of Education, verified district data</li>
                <li>Only districts with verified teacher-specific salary data are included</li>
                <li>Income data from Point2Homes (ACS-based) and WorldPopulationReview</li>
            </ul>
        </div>

        <!-- Academic Performance Section -->
        <div class="performance-section">
            <h2>Academic Performance vs Teacher Salary Analysis</h2>
            <div class="subtitle">2024 Illinois Assessment of Readiness (IAR) Results</div>

            <div class="subject-selector">
                <label>
                    <input type="radio" name="subject" value="math" checked> Mathematics
                </label>
                <label>
                    <input type="radio" name="subject" value="ela"> English Language Arts
                </label>
            </div>

            <div class="chart-wrapper">
                <canvas id="performanceChart"></canvas>
            </div>

            <div class="correlation" id="performanceCorrelation">
                Performance correlation will be calculated...
            </div>

            <div class="stats">
                <div class="stat-box">
                    <h3>Academic Performance (2024)</h3>
                    <div id="performanceStats">Loading...</div>
                </div>
                <div class="stat-box">
                    <h3>Performance vs Salary</h3>
                    <div id="performanceSalaryStats">Loading...</div>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>District</th>
                        <th>Avg Teacher Salary</th>
                        <th id="performanceHeader">Math Proficiency (%)</th>
                        <th>Performance per $100k</th>
                        <th>Data Year</th>
                    </tr>
                </thead>
                <tbody id="performanceTableBody"></tbody>
            </table>

            <div class="note">
                <strong>Performance Data Sources:</strong>
                <ul>
                    <li>Academic Performance: Illinois Assessment of Readiness (IAR) 2024</li>
                    <li>Proficiency = % of students meeting or exceeding standards</li>
                    <li>Performance per $100k = Proficiency percentage per $100,000 of teacher salary (efficiency metric)</li>
                    <li>Limited to districts with available performance data</li>
                </ul>
            </div>
        </div>

        <!-- Community Income vs Performance Section -->
        <div class="performance-section">
            <h2>Academic Performance vs Community Income Analysis</h2>
            <div class="subtitle">2024 IAR Results vs 2019-2023 ACS Average Household Income</div>

            <div class="subject-selector">
                <label>
                    <input type="radio" name="incomeSubject" value="math" checked> Mathematics
                </label>
                <label>
                    <input type="radio" name="incomeSubject" value="ela"> English Language Arts
                </label>
            </div>

            <div class="chart-wrapper">
                <canvas id="incomePerformanceChart"></canvas>
            </div>

            <div class="correlation" id="incomePerformanceCorrelation">
                Income-Performance correlation will be calculated...
            </div>

            <div class="stats">
                <div class="stat-box">
                    <h3>Community Income vs Performance</h3>
                    <div id="incomePerformanceStats">Loading...</div>
                </div>
                <div class="stat-box">
                    <h3>Socioeconomic Impact</h3>
                    <div id="socioeconomicStats">Loading...</div>
                </div>
            </div>

            <div class="note">
                <strong>Community Income vs Performance Analysis:</strong>
                <ul>
                    <li>Shows relationship between community wealth and academic outcomes</li>
                    <li>Helps distinguish socioeconomic effects from teacher salary effects</li>
                    <li>River Forest highlighted to show performance relative to community income</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // VERIFIED teacher salary data with sources
        const districts = [
            {
                district: "River Forest SD 90",
                income: 245054,
                salary: 77631,  // Illinois Report Card - $1,652 above state avg
                source: "Illinois Report Card 2024"
            },
            {
                district: "Hinsdale CCSD 181",
                income: 376366,
                salary: 98222,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Winnetka SD 36",
                income: 457404,
                salary: 98072,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Lake Forest SD 67",
                income: 302171,
                salary: 89256,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Elmwood Park CUSD 401",
                income: 101036,
                salary: 83681,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Berwyn South SD 100",
                income: 94096,
                salary: 67419,  // From JSON endpoint 2023
                source: "Illinois ISBE 2023"
            },
            {
                district: "Forest Park SD 91",
                income: 109157,
                salary: 77941,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Melrose Park ESD 89",
                income: 64740,
                salary: 73406,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Kenilworth SD 38",
                income: 460411,
                salary: 103079,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Oak Park ESD 97",
                income: 157707,
                salary: 85619,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Evanston/Skokie SD 65",
                income: 159197,
                salary: 91558,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Downers Grove GSD 58",
                income: 163851,
                salary: 91729,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Wheaton CUSD 200",
                income: 165445,
                salary: 78013,  // From JSON endpoint 2021
                source: "Illinois ISBE 2021"
            },
            {
                district: "Deerfield SD 109",
                income: 246543,
                salary: 83273,  // From JSON endpoint 2023
                source: "Illinois ISBE 2023"
            },
            {
                district: "Oak Brook (Butler 53)",
                income: 264446,
                salary: 86720,  // Previously verified
                source: "District average"
            },
            {
                district: "Park Ridge CCSD 64",
                income: 187830,
                salary: 94637,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Elmhurst CUSD 205",
                income: 200730,
                salary: 93125,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Northbrook SD 28",
                income: 218418,
                salary: 97923,  // From JSON endpoint 2023
                source: "Illinois ISBE 2023"
            },
            {
                district: "Glenview CCSD 34",
                income: 199761,
                salary: 81377,  // From JSON endpoint 2023
                source: "Illinois ISBE 2023"
            },
            {
                district: "Wilmette SD 39",
                income: 291930,
                salary: 86561,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Highland Park SD 112",
                income: 247484,
                salary: 82199,  // From JSON endpoint 2022
                source: "Illinois ISBE 2022"
            },
            {
                district: "Barrington CUSD 220",
                income: 209856,
                salary: 93926,  // From JSON endpoint 2023
                source: "Illinois ISBE 2023"
            },
            {
                district: "Arlington Heights SD 25",
                income: 147683,
                salary: 78022,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Cicero SD 99",
                income: 83618,
                salary: 85635,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Bellwood SD 88",
                income: 90217,
                salary: 63145,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Northlake SD 92",
                income: 85122,
                salary: 54053,  // From JSON endpoint 2022
                source: "Illinois ISBE 2022"
            },
            {
                district: "La Grange SD 102",
                income: 210646,
                salary: 75978,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Burr Ridge SD 180",
                income: 242236,
                salary: 76259,  // From JSON endpoint 2022
                source: "Illinois ISBE 2022"
            },
            {
                district: "Naperville CUSD 203",
                income: 192516,
                salary: 88756,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Glen Ellyn SD 41",
                income: 190562,
                salary: 87335,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            },
            {
                district: "Northfield SD 31",
                income: 281510,
                salary: 79132,  // From JSON endpoint 2023
                source: "Illinois ISBE 2023"
            },
            {
                district: "Glencoe SD 35",
                income: 413718,
                salary: 102049,  // From JSON endpoint 2024
                source: "Illinois ISBE 2024"
            }
        ];

        // Academic performance data (2024 IAR results - % meeting or exceeding standards)
        const performanceData = [
            {
                district: "River Forest SD 90",
                salary: 77631,
                mathProficiency: 66.8,
                elaProficiency: 76.4,
                dataYear: "2024"
            },
            {
                district: "Kenilworth SD 38",
                salary: 103079,
                mathProficiency: 67.3,
                elaProficiency: 75.2,
                dataYear: "2024"
            },
            {
                district: "Glencoe SD 35",
                salary: 102049,
                mathProficiency: 74.2,
                elaProficiency: 74.1,
                dataYear: "2024"
            },
            {
                district: "Hinsdale CCSD 181",
                salary: 98222,
                mathProficiency: 77.1,
                elaProficiency: 83.0,
                dataYear: "2024"
            },
            {
                district: "Winnetka SD 36",
                salary: 98072,
                mathProficiency: 72.0,
                elaProficiency: 72.1,
                dataYear: "2024"
            },
            {
                district: "Northbrook SD 28",
                salary: 97923,
                mathProficiency: 74.3,
                elaProficiency: 80.6,
                dataYear: "2024"
            },
            {
                district: "Park Ridge CCSD 64",
                salary: 94637,
                mathProficiency: 52.5,
                elaProficiency: 65.1,
                dataYear: "2024"
            },
            {
                district: "Barrington CUSD 220",
                salary: 93926,
                mathProficiency: 51.1,
                elaProficiency: 70.8,
                dataYear: "2024"
            },
            {
                district: "Elmhurst CUSD 205",
                salary: 93125,
                mathProficiency: 57.9,
                elaProficiency: 67.6,
                dataYear: "2024"
            },
            {
                district: "Downers Grove GSD 58",
                salary: 91729,
                mathProficiency: 55.3,
                elaProficiency: 61.5,
                dataYear: "2024"
            },
            {
                district: "Evanston/Skokie SD 65",
                salary: 91558,
                mathProficiency: 42.8,
                elaProficiency: 53.5,
                dataYear: "2024"
            },
            {
                district: "Lake Forest SD 67",
                salary: 89256,
                mathProficiency: 62.1,
                elaProficiency: 67.9,
                dataYear: "2024"
            },
            {
                district: "Naperville CUSD 203",
                salary: 88756,
                mathProficiency: 59.5,
                elaProficiency: 72.8,
                dataYear: "2024"
            },
            {
                district: "Glen Ellyn SD 41",
                salary: 87335,
                mathProficiency: 56.5,
                elaProficiency: 63.2,
                dataYear: "2024"
            },
            {
                district: "Oak Brook (Butler 53)",
                salary: 86720,
                mathProficiency: 75.3,
                elaProficiency: 80.8,
                dataYear: "2024"
            },
            {
                district: "Wilmette SD 39",
                salary: 86561,
                mathProficiency: 64.3,
                elaProficiency: 78.0,
                dataYear: "2024"
            },
            {
                district: "Cicero SD 99",
                salary: 85635,
                mathProficiency: 13.1,
                elaProficiency: 23.6,
                dataYear: "2024"
            },
            {
                district: "Oak Park ESD 97",
                salary: 85619,
                mathProficiency: 44.8,
                elaProficiency: 55.1,
                dataYear: "2024"
            },
            {
                district: "Elmwood Park CUSD 401",
                salary: 83681,
                mathProficiency: 24.8,
                elaProficiency: 46.4,
                dataYear: "2024"
            },
            {
                district: "Deerfield SD 109",
                salary: 83273,
                mathProficiency: 63.9,
                elaProficiency: 72.9,
                dataYear: "2024"
            },
            {
                district: "Highland Park SD 112",
                salary: 82199,
                mathProficiency: 51.5,
                elaProficiency: 58.5,
                dataYear: "2024"
            },
            {
                district: "Glenview CCSD 34",
                salary: 81377,
                mathProficiency: 57.7,
                elaProficiency: 64.5,
                dataYear: "2024"
            },
            {
                district: "Northlake SD 92 (Berkeley 87)",
                salary: 54053,
                mathProficiency: 14.2,
                elaProficiency: 16.3,
                dataYear: "2024"
            },
            {
                district: "Arlington Heights SD 25",
                salary: 78022,
                mathProficiency: 51.0,
                elaProficiency: 63.3,
                dataYear: "2024"
            },
            {
                district: "Wheaton CUSD 200",
                salary: 78013,
                mathProficiency: 49.7,
                elaProficiency: 64.9,
                dataYear: "2024"
            },
            {
                district: "Forest Park SD 91",
                salary: 77941,
                mathProficiency: 22.0,
                elaProficiency: 42.3,
                dataYear: "2024"
            },
            {
                district: "Burr Ridge SD 180",
                salary: 76259,
                mathProficiency: 10.4,
                elaProficiency: 36.6,
                dataYear: "2024"
            },
            {
                district: "La Grange SD 102",
                salary: 75978,
                mathProficiency: 52.8,
                elaProficiency: 67.1,
                dataYear: "2024"
            },
            {
                district: "Melrose Park ESD 89",
                salary: 73406,
                mathProficiency: 13.2,
                elaProficiency: 30.0,
                dataYear: "2024"
            },
            {
                district: "Berwyn South SD 100",
                salary: 67419,
                mathProficiency: 24.2,
                elaProficiency: 35.1,
                dataYear: "2024"
            },
            {
                district: "Bellwood SD 88",
                salary: 63145,
                mathProficiency: 8.6,
                elaProficiency: 17.5,
                dataYear: "2024"
            }
            // Additional districts will be added as data becomes available
        ];

        // Calculate correlation
        function calculateCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);

            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));

            return numerator / denominator;
        }

        // Extract data
        const incomes = districts.map(d => d.income);
        const salaries = districts.map(d => d.salary);

        // Calculate statistics
        const correlation = calculateCorrelation(incomes, salaries);

        // Update correlation display
        document.getElementById('correlation').innerHTML = `
            Correlation: r = ${correlation.toFixed(3)} (${correlation > 0.7 ? 'Strong' : correlation > 0.3 ? 'Moderate' : 'Weak'} Positive)
        `;

        // Update stats
        document.getElementById('incomeStats').innerHTML = `
            Range: $${Math.min(...incomes).toLocaleString()} - $${Math.max(...incomes).toLocaleString()}<br>
            Average: $${Math.round(incomes.reduce((a, b) => a + b) / incomes.length).toLocaleString()}
        `;

        document.getElementById('salaryStats').innerHTML = `
            Range: $${Math.min(...salaries).toLocaleString()} - $${Math.max(...salaries).toLocaleString()}<br>
            Average: $${Math.round(salaries.reduce((a, b) => a + b) / salaries.length).toLocaleString()}
        `;

        // Calculate trend line
        const n = incomes.length;
        const sumX = incomes.reduce((a, b) => a + b, 0);
        const sumY = salaries.reduce((a, b) => a + b, 0);
        const sumXY = incomes.reduce((sum, x, i) => sum + x * salaries[i], 0);
        const sumX2 = incomes.reduce((sum, x) => sum + x * x, 0);

        const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
        const intercept = (sumY - slope * sumX) / n;

        const minX = Math.min(...incomes);
        const maxX = Math.max(...incomes);
        const trendLine = [
            { x: minX, y: slope * minX + intercept },
            { x: maxX, y: slope * maxX + intercept }
        ];

        // Create chart
        const ctx = document.getElementById('chart').getContext('2d');
        new Chart(ctx, {
            type: 'scatter',
            data: {
                datasets: [
                    {
                        label: 'School Districts',
                        data: districts.map((d, index) => ({
                            x: d.income,
                            y: d.salary,
                            label: d.district,
                            index: index
                        })),
                        backgroundColor: districts.map(d =>
                            d.district.includes('River Forest') ? 'rgba(255, 99, 132, 0.8)' : 'rgba(54, 162, 235, 0.8)'
                        ),
                        borderColor: districts.map(d =>
                            d.district.includes('River Forest') ? 'rgba(255, 99, 132, 1)' : 'rgba(54, 162, 235, 1)'
                        ),
                        borderWidth: districts.map(d =>
                            d.district.includes('River Forest') ? 3 : 2
                        ),
                        pointRadius: districts.map(d =>
                            d.district.includes('River Forest') ? 12 : 8
                        ),
                        pointHoverRadius: districts.map(d =>
                            d.district.includes('River Forest') ? 15 : 10
                        )
                    },
                    {
                        label: 'Trend Line',
                        data: trendLine,
                        type: 'line',
                        borderColor: 'rgba(255, 0, 0, 0.8)',
                        backgroundColor: 'rgba(255, 0, 0, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false,
                        tension: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Avg Household Income vs Avg Teacher Salary',
                        font: { size: 16, weight: 'bold' }
                    },
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                return context[0].raw.label;
                            },
                            label: function(context) {
                                return [
                                    `Income: $${context.parsed.x.toLocaleString()}`,
                                    `Salary: $${context.parsed.y.toLocaleString()}`
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'Avg Household Income ($)',
                            font: { weight: 'bold' }
                        },
                        ticks: {
                            callback: function(value) {
                                return '$' + (value/1000).toFixed(0) + 'k';
                            }
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Avg Teacher Salary ($)',
                            font: { weight: 'bold' }
                        },
                        ticks: {
                            callback: function(value) {
                                return '$' + (value/1000).toFixed(0) + 'k';
                            }
                        }
                    }
                }
            }
        });

        // Populate table
        const tbody = document.getElementById('tableBody');
        districts
            .sort((a, b) => b.salary - a.salary)
            .forEach(d => {
                const row = tbody.insertRow();
                const isRiverForest = d.district.includes('River Forest');
                row.innerHTML = `
                    <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2); font-weight: bold;' : ''}">${d.district}</td>
                    <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2);' : ''}">$${d.income.toLocaleString()}</td>
                    <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2); font-weight: bold;' : ''}">$${d.salary.toLocaleString()}</td>
                    <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2);' : ''}"><small>${d.source}</small></td>
                `;
            });

        // Performance Chart Functionality
        let performanceChart;
        let currentSubject = 'math';

        function createPerformanceChart(subject) {
            const ctx = document.getElementById('performanceChart').getContext('2d');

            if (performanceChart) {
                performanceChart.destroy();
            }

            const data = performanceData.map(d => ({
                x: d.salary,
                y: subject === 'math' ? d.mathProficiency : d.elaProficiency,
                label: d.district
            }));

            const subjectName = subject === 'math' ? 'Mathematics' : 'English Language Arts';

            // Calculate regression line
            const salaries = performanceData.map(d => d.salary);
            const scores = performanceData.map(d => subject === 'math' ? d.mathProficiency : d.elaProficiency);

            const n = salaries.length;
            const sumX = salaries.reduce((a, b) => a + b, 0);
            const sumY = scores.reduce((a, b) => a + b, 0);
            const sumXY = salaries.reduce((sum, x, i) => sum + x * scores[i], 0);
            const sumX2 = salaries.reduce((sum, x) => sum + x * x, 0);

            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            const minSalary = Math.min(...salaries);
            const maxSalary = Math.max(...salaries);
            const regressionLine = [
                { x: minSalary, y: slope * minSalary + intercept },
                { x: maxSalary, y: slope * maxSalary + intercept }
            ];

            performanceChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'School Districts',
                            data: data,
                            backgroundColor: data.map(d =>
                                d.label.includes('River Forest') ? 'rgba(255, 99, 132, 0.8)' : 'rgba(34, 139, 34, 0.8)'
                            ),
                            borderColor: data.map(d =>
                                d.label.includes('River Forest') ? 'rgba(255, 99, 132, 1)' : 'rgba(34, 139, 34, 1)'
                            ),
                            borderWidth: data.map(d =>
                                d.label.includes('River Forest') ? 3 : 2
                            ),
                            pointRadius: data.map(d =>
                                d.label.includes('River Forest') ? 12 : 8
                            )
                        },
                        {
                            label: 'Regression Line',
                            data: regressionLine,
                            type: 'line',
                            borderColor: 'rgba(255, 165, 0, 0.8)',
                            backgroundColor: 'rgba(255, 165, 0, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${subjectName} Proficiency vs Avg Teacher Salary`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.label;
                                },
                                label: function(context) {
                                    return [
                                        `Salary: $${context.parsed.x.toLocaleString()}`,
                                        `${subjectName} Proficiency: ${context.parsed.y.toFixed(1)}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Avg Teacher Salary ($)',
                                font: { weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value/1000).toFixed(0) + 'k';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: `${subjectName} Proficiency (%)`,
                                font: { weight: 'bold' }
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });

            // Update correlation (using already calculated arrays)
            const correlation = calculateCorrelation(salaries, scores);

            document.getElementById('performanceCorrelation').innerHTML = `
                ${subjectName} Performance vs Salary Correlation: r = ${correlation.toFixed(3)}
            `;

            // Update stats
            document.getElementById('performanceStats').innerHTML = `
                Range: ${Math.min(...scores).toFixed(1)}% - ${Math.max(...scores).toFixed(1)}%<br>
                Average: ${(scores.reduce((a, b) => a + b) / scores.length).toFixed(1)}%
            `;

            // Update table
            updatePerformanceTable(subject);
        }

        function updatePerformanceTable(subject) {
            const tbody = document.getElementById('performanceTableBody');
            const header = document.getElementById('performanceHeader');

            const subjectName = subject === 'math' ? 'Math' : 'ELA';
            header.textContent = `${subjectName} Proficiency (%)`;

            tbody.innerHTML = '';
            performanceData
                .sort((a, b) => {
                    const aProficiency = subject === 'math' ? a.mathProficiency : a.elaProficiency;
                    const bProficiency = subject === 'math' ? b.mathProficiency : b.elaProficiency;
                    const aEfficiency = aProficiency / a.salary * 100000;
                    const bEfficiency = bProficiency / b.salary * 100000;
                    return bEfficiency - aEfficiency; // Sort by efficiency (performance per $100k), highest first
                })
                .forEach(d => {
                    const row = tbody.insertRow();
                    const isRiverForest = d.district.includes('River Forest');
                    const proficiency = subject === 'math' ? d.mathProficiency : d.elaProficiency;
                    const performancePerDollar = (proficiency / d.salary * 100000).toFixed(2); // Performance per $100k salary

                    row.innerHTML = `
                        <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2); font-weight: bold;' : ''}">${d.district}</td>
                        <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2);' : ''}">$${d.salary.toLocaleString()}</td>
                        <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2); font-weight: bold;' : ''}">${proficiency.toFixed(1)}%</td>
                        <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2); font-weight: bold;' : ''}">${performancePerDollar}</td>
                        <td style="${isRiverForest ? 'background-color: rgba(255, 99, 132, 0.2);' : ''}">${d.dataYear}</td>
                    `;
                });
        }

        // Subject selection event listeners
        document.querySelectorAll('input[name="subject"]').forEach(radio => {
            radio.addEventListener('change', function() {
                currentSubject = this.value;
                createPerformanceChart(currentSubject);
            });
        });

        // Initialize performance chart
        createPerformanceChart('math');

        // Income vs Performance Chart Functionality
        let incomePerformanceChart;
        let currentIncomeSubject = 'math';

        // Merge performance data with household income data
        function createIncomePerformanceData() {
            const mergedData = [];
            performanceData.forEach(perfDistrict => {
                const matchingDistrict = districts.find(d => d.district === perfDistrict.district);
                if (matchingDistrict) {
                    mergedData.push({
                        district: perfDistrict.district,
                        income: matchingDistrict.income,
                        mathProficiency: perfDistrict.mathProficiency,
                        elaProficiency: perfDistrict.elaProficiency,
                        salary: perfDistrict.salary
                    });
                }
            });
            return mergedData;
        }

        function createIncomePerformanceChart(subject) {
            const ctx = document.getElementById('incomePerformanceChart').getContext('2d');

            if (incomePerformanceChart) {
                incomePerformanceChart.destroy();
            }

            const mergedData = createIncomePerformanceData();
            const data = mergedData.map(d => ({
                x: d.income,
                y: subject === 'math' ? d.mathProficiency : d.elaProficiency,
                label: d.district
            }));

            const subjectName = subject === 'math' ? 'Mathematics' : 'English Language Arts';

            // Calculate regression line
            const incomes = mergedData.map(d => d.income);
            const scores = mergedData.map(d => subject === 'math' ? d.mathProficiency : d.elaProficiency);

            const n = incomes.length;
            const sumX = incomes.reduce((a, b) => a + b, 0);
            const sumY = scores.reduce((a, b) => a + b, 0);
            const sumXY = incomes.reduce((sum, x, i) => sum + x * scores[i], 0);
            const sumX2 = incomes.reduce((sum, x) => sum + x * x, 0);

            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;

            const minIncome = Math.min(...incomes);
            const maxIncome = Math.max(...incomes);
            const regressionLine = [
                { x: minIncome, y: slope * minIncome + intercept },
                { x: maxIncome, y: slope * maxIncome + intercept }
            ];

            incomePerformanceChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'School Districts',
                            data: data,
                            backgroundColor: data.map(d =>
                                d.label.includes('River Forest') ? 'rgba(255, 99, 132, 0.8)' : 'rgba(75, 192, 192, 0.8)'
                            ),
                            borderColor: data.map(d =>
                                d.label.includes('River Forest') ? 'rgba(255, 99, 132, 1)' : 'rgba(75, 192, 192, 1)'
                            ),
                            borderWidth: data.map(d =>
                                d.label.includes('River Forest') ? 3 : 2
                            ),
                            pointRadius: data.map(d =>
                                d.label.includes('River Forest') ? 12 : 8
                            )
                        },
                        {
                            label: 'Regression Line',
                            data: regressionLine,
                            type: 'line',
                            borderColor: 'rgba(255, 165, 0, 0.8)',
                            backgroundColor: 'rgba(255, 165, 0, 0.1)',
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false,
                            tension: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `${subjectName} Proficiency vs Avg Household Income`,
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.label;
                                },
                                label: function(context) {
                                    return [
                                        `Income: $${context.parsed.x.toLocaleString()}`,
                                        `${subjectName} Proficiency: ${context.parsed.y.toFixed(1)}%`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Avg Household Income ($)',
                                font: { weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value/1000).toFixed(0) + 'k';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: `${subjectName} Proficiency (%)`,
                                font: { weight: 'bold' }
                            },
                            min: 0,
                            max: 100
                        }
                    }
                }
            });

            // Update correlation and stats
            const correlation = calculateCorrelation(incomes, scores);

            document.getElementById('incomePerformanceCorrelation').innerHTML = `
                ${subjectName} Performance vs Community Income Correlation: r = ${correlation.toFixed(3)}
            `;

            document.getElementById('incomePerformanceStats').innerHTML = `
                Income Range: $${Math.min(...incomes).toLocaleString()} - $${Math.max(...incomes).toLocaleString()}<br>
                Performance Range: ${Math.min(...scores).toFixed(1)}% - ${Math.max(...scores).toFixed(1)}%
            `;

            document.getElementById('socioeconomicStats').innerHTML = `
                Correlation Strength: ${correlation > 0.7 ? 'Strong' : correlation > 0.3 ? 'Moderate' : 'Weak'}<br>
                Socioeconomic Impact: ${correlation > 0.5 ? 'Significant' : 'Limited'}
            `;
        }

        // Income subject selection event listeners
        document.querySelectorAll('input[name="incomeSubject"]').forEach(radio => {
            radio.addEventListener('change', function() {
                currentIncomeSubject = this.value;
                createIncomePerformanceChart(currentIncomeSubject);
            });
        });

        // Initialize income performance chart
        createIncomePerformanceChart('math');
    </script>
</body>
</html>